\begin{section}{Chinese Restaurant Process}
% LTeX: language=de-DE
    Der \glqq Chinese Restaurant Process\grqq, dient der Konstruktion von zufälligen austauschbaren Partitionen, mithilfe welcher die Analyse von Bäumen erleichtert wird. In Kapitel \textcolor{red}{add something}, wird eine Bijektion zwischen den Bäumen und Partitionen aufgestellt und dies erlaubt uns, die in diesem Kapitel entwickelte Theorie anzuwenden. Wir beginnen mit der Konstruktion vom \glqq Chinese Restaurant Process\grqq.\\
\newline
\textbf{\fontsize{14}{18}\selectfont Konstruktion von CRP}
\\
Bevor die Konstruktion vom Prozess beschrieben wird, wollen wir vorab das Ziel der Konstruktion erläutern. Die Konstruktion erlaubt uns eine konsistente Folge von austauschbaren zufälligen Partitionen von $[n]$ zu erzeugen, also eine zufällige Partition $\Pi_\infty := (\Pi_n)_{n \in \mathbb{N}}$ von $\mathbb{N}$ zu generieren. Dies erlaubt uns u.a. Kingmans Sätze wie \textit{Kingman's Correspondance} und \textit{Kingman's representation} zu nutzen und somit Aussagen über die Grenzwerte der Größe der Blöcke von Partitionen zu formulieren. Wir beginnen mit einer einfachen Form des Prozesses: \\
\\
Wir betrachten eine Folge von zufälligen Permutationen $ \{\sigma_n, n \in \mathbb{N}\}$, sodass 
\begin{enumerate}
    \item $ \{\sigma_n\}$ Uniform verteilt auf $[n]$ ist.
    \item $\forall n \in \mathbb{N}$, falls $\sigma_n$ als Produkt von Zyklen dargestellt wird, $\sigma_{n-1}$ von $\sigma_n$ durch Deletion von Element $n$ zurückgewonnen wird.   
\end{enumerate}
Die Verteilung, die durch diese zwei Regeln entsteht, kann durch einen zufälligen Sitzplan in einem chinesischen Restaurant beschrieben werden. Man stelle sich das Restaurant zunächst vor als eine Sammlung von abzählbar unendlichen vielen Tischen, wo jeder Tisch die Sitzplatzkapazität von abzählbar unendlich vielen Kunden hat. Die Kunden, nummeriert mit den natürlichen Zahlen nach Reihenfolge Ihres Erscheinens, werden nach folgenden Regeln platziert.
\begin{enumerate}
    \item Der erste Kunde sitzt an Tisch 1
    \item Falls zum Zeitpunkt des Eintritts des $i$-ten Kundes $k$ Tische besetzt sind, so setzt sich dieser mit gleicher Wahrscheinlichkeit $(\frac{1}{n+1})$ links von Kunden $i: i \in \{1...n\}$ oder an einem neuen Tisch $k+1$.
\end{enumerate}
Wir definieren nun $\sigma_n: [n] \rightarrow [n]$ mithilfe dieser Regeln, sodass falls Kunde $i$ links von Kunde $j$ sitzt, $\sigma_n(i) = j$ und falls Kunde $i$ alleine sitzt $\sigma_n(i) = i$. Dass diese Folge von
Permutationen die ersten 2 Regeln befolgt, ist durch eine triviale Induktion ersichtlich. 
\\
Die Folge, die durch die Zyklen von den Permutationen generiert werden, ist austauschbar und konsistent, generiert somit eine austauschbare Folge $\Pi_\infty$ von $\mathbb{N}$.
    %\item Falls zum Zeitpunkt des Eintritts des $i$-ten Kundes $k$ Tische besetzt sind, so setzt sich dieser an Tisch $j \in {1...k}$ mit Wahrscheinlichkeit $\frac{n_i-\alpha}{n+\theta}$ und an Tisch $k+1$ mit Wahrscheinlichkeit $\frac{\theta + k\alpha}{n + \theta}$
\end{section}
\begin{section}{Verallgemeinerte CRP}
Die einfache Konstruktion vom \textit{Chinese Restaurant Process} lässt sich recht einfach verallgemeinern, sodass eine größere Klasse von austauschbaren Partitionen betrachtet werden können. Anstatt, wie im einfachen Fall, nur uniform ein Sitzplatz auszuwählen (Regel 2), wird in der allgemeinen Form des Prozesses eine beliebige Folge $(P_1,P_2...)$ von Zufallsvariablen, mit $\sum_{i\geq1}P_i \leq 1$ und $P_i \geq 0$ gewählt, und die zweite Regel mit folgender ersetzt:
\begin{itemize} 
    \item Falls zum Zeitpunkt des Eintritts des i-ten Kundes $k$ Tische besetzt sind, so setzt sich dieser mit Wahrscheinlichkeit $P_j, j \in \{1...k\}$ an Tisch $j$ und mit Wahrscheinlichkeit $1 - \sum_{j=1}^{k}P_j$ an einen neuen Tisch.
\end{itemize}
Dieser Prozess erlaubt es nicht nur jede austauschbare Folge zu konstruieren, sondern tatsächlich jede partiell austauschbare Folge zu konstruieren. Beruhend auf dieser Konstruktion, hat Pitman \cite{pitman1995exchangeable} folgende Variation von \textit{Kingman's Representation} bewiesen
\begin{theorem}
    \label{pitman}
    Sei $\Pi_\infty$ eine zufällige Partition von $\mathbb{N}$, dann sind folgende Äquivalent
    \begin{enumerate}
        \item $\Pi_\infty$ ist partiell Austauschbar
        \item Falls wir die Tische mit Partitionen identifizieren, dann wird $\Pi_\infty$ gegeben $(P_1,P_2...)$ durch den verallgemeinerten \textit{Chinese Restaurant Process} generiert. Also $\forall{n} \in \mathbb{N}$ bedingt gegeben $(P_1,P_2...)$ und $\Pi_n = \{A_1,A_2,...A_k\}$, mit $A_i, i \in \{1...k\}$ in Reihenfolge ihres Erscheinens, $\Pi_{n+1}$ eine Erweiterung von $\Pi_n$ ist, wobei $n+1$ zur Klasse $A_i$ mit Wahrscheinlichkeit $P_i$ angefügt wird und zur einer neuen Klasse $A_{k+1}$ mit Wahrscheinlichkeit $1 - \sum_{i=1}^{k}P_i$ angefügt wird. 
    \end{enumerate}
Weiter sind die $P_i$ in 2. fast sicher eindeutig und gleich der fast sicheren asymptotischen Frequenz der Klassen $A_i$, also
\[ 
\frac{|A_i \cap [n]|}{n} \to P_i \hspace{10pt} \text{P -f.s.} \hspace{5pt} \text{für } n \to \infty.
\]
\end{theorem}
\begin{proof}
    Dieser Satz wird in \cite{pitman1995exchangeable} bewiesen.
\end{proof}
\begin{Bemerkung}
    Der Vorteil von Pitmans Charakterisierung von partiell Austauschbaren Folgen gegenüber \textit{Kingman's Representation} ist die Bestimmung der Verteilung $(P_1,P_2...)$ im Vergleich zu der sortierten Folge $(P^\downarrow_1,P^\downarrow_2,...)$, welche durch die Konstruktion vom \textit{Chinese Restaurant Process} erleichtert wird. Mithilfe vom Korollar \ref{korollar pitman} lässt sich die $PEPF$, bzw. $EPPF$ im austauschbaren Fall, recht einfach berechnen.
\end{Bemerkung}
\begin{Korollar}
    \label{korollar pitman}
    Die PEPF $p$ von Satz \ref{pitman} hat Form
    \begin{equation}
    \label{PEPF expected value}    
    p(n_1,n_2,...,n_k) = \mathbb{E}\left[\prod_{i=1}^{k}P_i^{n_i-1}\prod_{i=1}^{k-1}(1-\sum_{j=1}^{i}P_j)\right].
    \end{equation}
\end{Korollar}
\begin{proof}
    Nach Definition \ref{Austauschbarkeit}, gilt mit $\mathbb{A}_n:= \{A_1,...A_k\}$ und $\mathbb{A}_{n-1}:= \mathbb{A}_n \cap [n-1]$ und Satz \ref{pitman}
    \begin{align*}
    p(|A_1|,...,|A_k|) &= \mathbb{P}(\Pi_n = \mathbb{A}) \\
    &= \mathbb{E}\left[\mathbb{P}(\Pi_n = \mathbb{A}_n|(P_1,P_2...))\right]  \\
    &= \mathbb{E}\left[\mathbb{P}(\Pi_n = \mathbb{A}_n|\Pi_{n-1} = \mathbb{A}_{n-1},(P_1,P_2...))\mathbb{P}(\Pi_{n-1} = \mathbb{A}_{n-1}|(P_1,P_2...))\right] \\
    &=... =  \mathbb{E}\left[\prod_{i=1}^{k}P_i^{n_i-1}\prod_{i=1}^{k-1}(1-\sum_{j=1}^{i}P_j)\right].
\end{align*}
\end{proof}
Mithilfe einer anderen Konstruktion von austauschbaren $\mathbb{N}$ \cite[Konstruktion 16]{pitman1995exchangeable}, stellt sich heraus, dass die $P_i$ in Form von einer \textit{Residual allocation Model (RAM)} sich darstellen lassen. Das bedeutet, dass unabhängige Zufallsvariablen $W_i, i \geq 1, W_i \in [0,1]$ existieren, sodass die $P_i$ aus Satz \ref{pitman} als Produkt von den $W_i$
\begin{equation}
    \label{RAM probability}
    P_i = W_i\prod_{j=1}^{i-1} (1-W_j)
\end{equation}
darstellen lassen. Korollar \ref{korollar pitman} ändert sich somit zu
\begin{Korollar}
    \label{second korollar Pitman}
    Die PEPF $p$ von Satz \ref{pitman} hat Form
    \[
    p(n_1,n_2,...,n_k) = \mathbb{E}\left[\prod_{i=1}^{k}W_i^{n_i-1}(1-W_i)^{\sum_{j=i+1}^{k}n_j}\right].
    \]
\end{Korollar}
\begin{proof}
   Wir nutzen \ref{RAM probability} und Induktion um zuerst
   \[
    \prod_{i=1}^{n}(1-W_i) = 1 - \sum_{i=1}^{n}P_i
   \] 
   zu zeigen.\\
   $n = 1$: klar. \\
   Sei die Aussage für $n$ Wahr, dann gilt 
   \begin{align*}
    1 - \sum_{i=1}^{n+1}P_i &\overset{I.A.}{=} \prod_{i=1}^{n}(1-W_i) - P_{n+1}\\
    &=  \prod_{i=1}^{n}(1-W_i) - W_{n+1}\prod_{i=1}^{n}(1-W_i) \\
    &= \prod_{i=1}^{n+1}(1-W_i).
   \end{align*}
   Eingesetzt in \ref{PEPF expected value}, liefert 
   \begin{align*}
    p(n_1,n_2,...,n_k) &= \mathbb{E}\left[\prod_{i=1}^{k}W_i^{n_i-1}\prod_{j=1}^{i-1}(1-W_j)^{n_i-1}\prod_{i=1}^{k-1}\prod_{j=1}^{i}(1-W_j)\right]\\
    &= \mathbb{E}\left[\prod_{i=1}^{k}W_i^{n_i-1}\prod_{j=1}^{i-1}(1-W_j)^{n_i-1}\prod_{i=1}^{k}\prod_{j=1}^{i-1}(1-W_j)\right]\\
    &= \mathbb{E}\left[\prod_{i=1}^{k}W_i^{n_i-1}\prod_{j=1}^{i-1}(1-W_j)^{n_i}\right]\\
    &=\mathbb{E}\left[\prod_{i=1}^{k}W_i^{n_i-1}(1-W_i)^{\sum_{j=i+1}^{k}n_j}\right].
   \end{align*}  

\end{proof}
Wir nutzen die bis jetzt entwickelte Theorie der austauschbaren Partitionen um eine Klasse von \textit{Chinese Restaurant Process} zu betrachten, welche für spätere Baumanalyse von Relevanz sein wird. Dafür ersetzen wir die zweite Regel in der Konstruktion vom verallgemeinerten \textit{Chinese Restaurant Process} mit genauen Wahrscheinlichkeiten. Für Parameter $\alpha$ und $\theta$ halten wir fest:
\begin{itemize} 
    \item Falls zum Zeitpunkt des Eintritts des i-ten Kundes $k$ Tische mit jeweils $(n_1,...,n_k)$ Kunden besetzt sind, so setzt sich dieser mit Wahrscheinlichkeit $\frac{n_j-\alpha}{n + \theta}$ an Tisch $j \in \{1...k\}$ und mit Wahrscheinlichkeit $\frac{\theta + k\alpha}{n + \theta}$ an einen neuen Tisch $k+1$.
\end{itemize}
Damit die Wahrscheinlichkeitsregeln bei dieser Konstruktion erhalten bleiben, müssen $\alpha$ und $\theta$ entsprechend gewählt werden, dafür gibt es 2 Fälle (Siehe Anhang, Lemma \ref{lemma cases crp}): 
\begin{enumerate}
    \item $ 0 \leq \alpha < 1$ und $\theta > - \alpha $ 
    \item $\alpha < 0$ und $\theta = -m \alpha$ für ein $m \in \mathbb{N}$
\end{enumerate}

Das Haupttheorem ist nun folgendes.
\begin{theorem}
    \label{Main theorem CRP}
    Für jede der Parameter $(\alpha,\theta)$, welche die oben genannten Voraussetzungen erfüllen, generiert das CRP eine austauschbare  Partition von $\mathbb{N}$. Die dazu gehörende EPPF (siehe Def. 3) ist 
    \begin{equation}
   p_{\alpha,\theta}(n_1,...,n_k) = \frac{\displaystyle \prod_{i=0}^{k-2}(\theta + \alpha + i\alpha)\prod_{j=1}^{k}\prod_{r=1}^{n_j-1}(r-\alpha)}{\displaystyle\prod_{i=1}^{n-1}(\theta  + i)}.
    \end{equation}
    Die zugehörigen asymptotischen Frequenzen, in \textit{Reihenfolge ihres Erscheinens}, können folgendermaßen repräsentiert werden.
    \[
    (P_1,P_2,P_3...) = (W_1,\bar{W_1}W_2,\bar{W_1}\bar{W_2}W_3...).
    \]
    Wobei $W_i$ unabhängig voneinander, nach $\beta(1 - \alpha, \theta + i\alpha)$ verteilt sind und $\bar{W_i}:= 1 - W_i$.
\end{theorem} 
Bevor wir zum Beweis kommen, definieren wir die $\beta$-Verteilung und nennen Eigenschaften.
\begin{Definition}
    \label{definition beta distribution}
    Eine Zufallsvariable $X$ ist $\beta(a,b),$ mit $ a,b > 0 $ verteilt, falls $X$ die Wahrscheinlichkeitsdichte 
    \[
        f(x) =
        \begin{cases}
        \frac{1}{B(a,b)} x^{a-1}(1-x)^{b-1}, \hspace{5pt} &x \in [0,1]  \\
        0 &\textnormal{sonst},
        \end{cases} 
   \]
mit 
\[
    B(a,b):= \frac{\Gamma(a+b)}{\Gamma(a)\Gamma(b)}
\]
besitzt. Hier bezeichnet $\Gamma$ die Gamma Funktion, $\Gamma(z)= \int_{0}^{\infty} t^{z-1}e^{-t}dt$.
\end{Definition}
Aus Korollar \ref{second korollar Pitman} werden oft nur die Momente von $W_i$ zur Verfügung stehen, woraus die Verteilung abgeleitet werden soll. Für Zufallsvariablen mit beschränkten Träger ist die Verteilung durch die Momente festgelegt, \cite[Theorem 30.1]{billingsley1995probability}, insbesondere auch für die $\beta$-Verteilung.
\begin{lemma}
    Für $X \sim \beta(a,b)$, gilt
    \[
    \mathbb{E}[X^k] = \prod_{r=0}^{k-1}\frac{a+r}{a+b  + r}.
    \]
\end{lemma}
\begin{proof}
    Die Momente werden über die Berechnung der momenterzeugenden Funktion von $X$ in \cite[Kapitel 25]{johnson1995continuous} bewiesen. 
\end{proof}

Insbesondere folgt für die Parameter aus Satz \ref{Main theorem CRP}: 
\begin{Korollar}
    \label{Korollar Momente beta}
    Für $X \sim \beta(1-\alpha,\theta + i\alpha)$, gilt:
    \[
    \mathbb{E}[X^k] = \prod_{r=1}^{k}\frac{r-\alpha}{r+\theta +(i-1)\alpha }.
    \]
\end{Korollar}
Mit diesem Hilfsmittel können wir nun den Satz beweisen.
\begin{proof}[Beweis von Satz \ref{Main theorem CRP}]
   Wir beginnen mit der Austauschbarkeit. Dafür prüfen wir zuerst, dass $p_{\alpha,\theta}$ tatsächlich unserer EPPF entspricht. Wir nutzen Lemma \ref{Austauschbar Lemma} und beachten, dass $p(1) = 1$. Weiter sind die Übergangswahrscheinlichkeiten von $p_{\alpha,\theta}$ genau die Übergangswahrscheinlichkeiten von $N_m$ aus dem Lemma. Nach Definition \ref{Austauschbarkeit} ist die \textit{PEPF} $p$ symmetrisch, also ist die Konstruktion austauschbar. Für die asymptotischen Frequenzen nutzen wir Lemma \ref{second korollar Pitman} und verfahren Induktiv um die $W_i$ zu bestimmen. Wir beachten, dass die Momente von $W_i$ eindeutig die $W_i$ charakterisieren, da Sie nach Voraussetzung beschränkten Träger in $[0,1]$ haben. Für $W_1$ sind die Momente nun:
    \begin{align*}
    p(i)= \mathbb{E}[W_1^{i-1}] &= \frac{\prod_{j=1}^{i-1}(j-\alpha)}{\prod_{j=1}^{i-1}(\theta+j)}\\
    &= \prod_{j=1}^{i-1}\frac{(j-\alpha)}{(\theta+j)}
    \end{align*}
und somit $W_1 \sim \beta(1-\alpha,\theta + \alpha)$ nach Korollar \ref{Korollar Momente beta}. Wir machen eine Induktion über $W_i$ und nehmen an, dass $W_n \sim \beta(1-\alpha,\theta+n\alpha)$. Für $W_{n+1}$ rechnen wir
    \begin{align*}
    \frac{p(\overbrace{1,..,1}^{n},i+1)}{p(\underbrace{1,..,1}_{n-1},i+2)}= \frac{\mathbb{E}[(1-W_n)^{i+1}]}{\mathbb{E}[(W_n)^{i+1}]}\mathbb{E}[W_{n+1}^i] \\
    \Rightarrow \frac{\theta + n\alpha}{i+1-\alpha}=  \prod_{r=0}^{i}\frac{\theta + n\alpha + r}{{1-\alpha + r}}\mathbb{E}[W_{n+1}^i]\\
    \Rightarrow \frac{\theta + n\alpha}{i+1-\alpha}\prod_{r=1}^{i+1}\frac{{r-\alpha }}{ r -1 + \theta + n\alpha }=  \mathbb{E}[W_{n+1}^i]\\
    \Rightarrow \prod_{r=2}^{i+1}\frac{1}{r -1 + \theta + n\alpha}\prod_{r=1}^{i}r-\alpha =  \mathbb{E}[W_{n+1}^i]\\
    \Rightarrow \prod_{r=1}^{i}\frac{r-\alpha}{r+\theta+n\alpha} = \mathbb{E}[W_{n+1}^i].
    \end{align*}
Die Aussage folgt.
\end{proof}
\begin{Definition}\textnormal{GEM und PD Verteilungen} \label{GEM und PD Verteilungen}\\
Die Verteilung der $(P_1,P_2...)$ aus Satz \ref{Main theorem CRP} wird nach Griffith-Engen-McCloskey für Parameter $\alpha,\theta$ die $GEM(\alpha,\theta)$-Verteilung genannt. Die dazugehörende Verteilung der nach der abfallenden-Größe sortierten $(P^{\downarrow}_i)_{i \in \mathbb{N}}$ wird mit \textit{Poisson-Dirichlet}$(\alpha,\theta)$, bzw. \textit{PD}$(\alpha,\theta)$-Verteilung gekennzeichnet. 
\end{Definition}
\end{section}